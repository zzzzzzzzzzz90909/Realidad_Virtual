<html>
<head>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/20.0.3/tween.umd.js"></script>
</head>
<body>
  <a-scene background="color: #ECECEC">

    <a-entity position="0 2 6" camera look-controls></a-entity>

    <a-entity light="type: directional; intensity: 1" position="3 5 7"></a-entity>
    <a-entity light="type: ambient; intensity: 0.5"></a-entity>

    <a-plane rotation="-90 0 0" width="12" height="12" color="#AAA"></a-plane>

    <a-entity id="robot" 
              gltf-model="GP12_AR1440.glb" 
              scale="0.5 0.5 0.5"
              position="0 0 0"
              rotation="0 0 0"
              industrial-process> </a-entity>

  </a-scene>

  <script>
    // 1. Registramos un nuevo componente de A-Frame llamado 'industrial-process'
    AFRAME.registerComponent('industrial-process', {
      init: function () {
        // 'this.el' se refiere a la entidad <a-entity id="robot">
        const robotEntity = this.el;
        let jointS, jointL, jointU; // Variables para guardar las articulaciones

        // 2. Esperamos a que el modelo 3D se haya cargado por completo
        robotEntity.addEventListener('model-loaded', () => {
          const model = robotEntity.object3D;

          // 3. ¡MUY IMPORTANTE! Busca los nombres de las articulaciones de tu modelo.
          // Los nombres 'Joint_1_S', 'Joint_2_L', 'Joint_3_U' son suposiciones.
          // Debes reemplazarlos por los nombres correctos de tu archivo .glb.
          // (Mira la sección "Cómo Encontrar los Nombres de las Articulaciones" más abajo)
          jointS = model.getObjectByName('Joint_1_S'); // Articulación base (giro horizontal)
          jointL = model.getObjectByName('Joint_2_L'); // Articulación del "hombro" (movimiento vertical)
          jointU = model.getObjectByName('Joint_3_U'); // Articulación del "codo"

          // Si las articulaciones se encontraron, iniciamos la secuencia
          if (jointS && jointL && jointU) {
            this.startProcess(jointS, jointL, jointU);
          } else {
            console.error("¡No se encontraron las articulaciones! Revisa los nombres en tu modelo 3D.");
            console.log("Estructura del modelo disponible:", model);
          }
        });
      },

      startProcess: function (jointS, jointL, jointU) {
        // 4. Creamos una secuencia de animaciones usando Tween.js
        const duration = 1500; // Duración de cada movimiento en milisegundos
        const easing = TWEEN.Easing.Quadratic.InOut; // Tipo de aceleración/desaceleración

        // Función para convertir grados a radianes (usado por el motor 3D)
        const toRad = (degrees) => degrees * (Math.PI / 180);

        // --- Definición de los Pasos de la Animación ---
        
        // Paso 1: Mover a la posición de recogida
        const pickPosition = new TWEEN.Tween(jointS.rotation)
          .to({ y: toRad(90) }, duration) // Gira la base 90 grados
          .easing(easing);
        
        const armDown = new TWEEN.Tween(jointL.rotation)
          .to({ z: toRad(45) }, duration) // Baja el hombro
          .easing(easing);
        
        const elbowDown = new TWEEN.Tween(jointU.rotation)
          .to({ z: toRad(60) }, duration) // Dobla el codo
          .easing(easing);

        // Paso 2: Volver a subir el brazo
        const armUp = new TWEEN.Tween(jointL.rotation)
          .to({ z: toRad(0) }, duration)
          .easing(easing);
        
        const elbowUp = new TWEEN.Tween(jointU.rotation)
          .to({ z: toRad(0) }, duration)
          .easing(easing);

        // Paso 3: Mover a la posición de colocación
        const placePosition = new TWEEN.Tween(jointS.rotation)
          .to({ y: toRad(-90) }, duration * 2) // Gira la base al otro lado
          .easing(easing);

        // Paso 4: Dejar el objeto (mismo movimiento que para recoger)
        const armDownAgain = new TWEEN.Tween(jointL.rotation)
          .to({ z: toRad(45) }, duration)
          .easing(easing);

        const elbowDownAgain = new TWEEN.Tween(jointU.rotation)
          .to({ z: toRad(60) }, duration)
          .easing(easing);

        // Paso 5: Volver a la posición inicial para repetir el ciclo
        const returnToStartBase = new TWEEN.Tween(jointS.rotation)
          .to({ y: toRad(0) }, duration)
          .easing(easing);

        const returnToStartArm = new TWEEN.Tween(jointL.rotation)
          .to({ z: toRad(0) }, duration)
          .easing(easing);

        const returnToStartElbow = new TWEEN.Tween(jointU.rotation)
          .to({ z: toRad(0) }, duration)
          .easing(easing);
        
        // 5. Encadenamos las animaciones para crear la secuencia
        pickPosition.chain(armUp);
        armDown.chain(armUp);
        elbowDown.chain(elbowUp);

        armUp.chain(placePosition);
        elbowUp.chain(placePosition);

        placePosition.chain(armDownAgain);
        armDownAgain.chain(returnToStartArm);
        elbowDownAgain.chain(returnToStartElbow);

        returnToStartArm.chain(returnToStartBase);
        returnToStartElbow.chain(returnToStartBase);
        
        // Cuando vuelve al inicio, se reinicia el ciclo completo
        returnToStartBase.onComplete(() => {
          pickPosition.start();
          armDown.start();
          elbowDown.start();
        });

        // ¡Iniciamos la primera animación!
        pickPosition.start();
        armDown.start();
        elbowDown.start();
      }
    });

    // 6. Bucle de animación para que Tween.js funcione
    function animate() {
      requestAnimationFrame(animate);
      TWEEN.update();
    }
    animate();

  </script>
</body>
</html>
